{"version":3,"sources":["webpack:///./src/js/controllers/IndexController.js"],"names":["populateSelectBox","selectEl","values","docFrag","document","createDocumentFragment","optionEl","createElement","forEach","value","option","cloneNode","textContent","appendChild","createRestaurant","restaurant","avgReview","_ref","className","id","altText","imageContainer","loadingIndicator","span","li","body","name","neighborhood","address","more","classList","add","Object","_utils__WEBPACK_IMPORTED_MODULE_0__","averageReview","setAttribute","href","restaurantUrl","title","concat","append","src","restaurantImgUrl","size","sizes","alt","image","parentNode","removeChild","IndexController","map","restaurants","pageElements","cuisineSelect","getElementById","filterForm","querySelector","neighborhoodSelect","restaurantsList","restaurantResultCount","render","_this","this","fetchRestaurants","then","_this$pageElements","mobileButtonBar","populateFilterForm","populateRestaurantsList","loadMap","addEventListener","handleFilterUpdates","bind","catch","console","error","neighborhoods","Set","r","cuisines","cuisine_type","_this$pageElements2","event","_this2","_this$pageElements3","selectedIndex","cuisine","Error","filter","stopPropagation","_this$pageElements4","rCount","length","resetRestaurants","innerHTML","updateMap","_this$pageElements5","markers","position","latlng","content","resetMap","addMarkers","removeMarkers","__webpack_exports__"],"mappings":"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","file":"./js/home.min.js","sourcesContent":["import {\n  DBHelper,\n  lazyLoadImages,\n  makeImage, \n  makeStarRating,\n  Map,\n} from '../utils';\n\n/**\n * Utility function to populate a select box with values.\n */\nconst populateSelectBox = (selectEl, values) => {\n  // Create a document fragment and option element\n  const docFrag = document.createDocumentFragment();\n  const optionEl = document.createElement('option');\n\n  // Add an option for each value\n  values.forEach(value => {\n    // Clone the option element\n    let option = optionEl.cloneNode();\n\n    // Set the textContent and value\n    option.textContent = value;\n    option.value = value;\n\n    // Append the option to the document fragment\n    docFrag.appendChild(option);\n  });\n\n  // Append the document fragment to the select box\n  selectEl.appendChild(docFrag);\n};\n\n/**\n * Creates an image inside of a container\n * Displays a loading spinner before the image \n * has finished loading.\n */\nconst createImage = ({ id, altText }, className) => {\n  const imageContainer = document.createElement('div');\n  const loadingIndicator = document.createElement('span');\n\n  imageContainer.className = 'image__container';\n  loadingIndicator.className = 'spinner';\n  imageContainer.appendChild(loadingIndicator);\n  imageContainer.appendChild(makeImage({\n    id,\n    src: DBHelper.restaurantImgUrl({id, size: 'small' }),\n    sizes: \"100vw\",\n    alt: altText,\n    className\n  }, image => {\n    loadingIndicator.parentNode && \n      loadingIndicator.parentNode.removeChild(loadingIndicator);\n    \n    imageContainer.appendChild(image);\n  }));\n  \n  return imageContainer;\n};\n\n/**\n * Generates the html for one restaurant list item.\n */\nconst createRestaurant = restaurant => {\n  // Create the necessary elements for later\n  const span = document.createElement('span');\n  const li = document.createElement('li');\n  const body = document.createElement('div');\n  const name = document.createElement('h2');\n  const neighborhood = span.cloneNode();\n  const address = document.createElement('address');\n  const more = document.createElement('a');\n  let avgReview;\n\n  // Give the list item a class\n  li.classList.add('restaurants-list__item');\n\n  // Content body\n  body.className = 'restaurant-item__info';\n\n  // Restaurant title\n  name.textContent = restaurant.name;\n  name.className = 'restaurant-item__title';\n\n  // Restaurant neighborhood\n  neighborhood.textContent = restaurant.neighborhood;\n  neighborhood.className = 'restaurant-item__neighborhood';\n\n  // Restaurant address\n  address.className = 'restaurant-item___address';\n  address.textContent = restaurant.address;\n\n  // Average Review\n  avgReview = makeStarRating(restaurant.averageReview);\n  avgReview.setAttribute('aria-label', 'Average review');\n\n  // View More button\n  more.textContent = 'Details';\n  more.href = DBHelper.restaurantUrl(restaurant);\n  more.title = `View additional details about ${restaurant.name}`;\n  more.className = 'restaurant-item__detail-link';\n\n  // Append content to the body\n  body.append(name);\n  body.append(avgReview);\n  body.append(neighborhood);\n  body.append(address);\n  body.append(more);\n\n  li.append(createImage(restaurant, 'restaurant-item__image'));\n  li.append(body);\n\n  return li;\n};\n\nconst IndexController = {\n  map: null,\n  restaurants: null,\n  pageElements: {\n    cuisineSelect: document.getElementById('cuisine'),\n    filterForm: document.querySelector('.filters'),\n    neighborhoodSelect: document.getElementById('neighborhood'),\n    restaurantsList: document.querySelector('.restaurants-list'),\n    restaurantResultCount: document.querySelector('.restaurant-count'),\n  },\n  \n  render() {\n    DBHelper.fetchRestaurants()\n      .then(restaurants => {\n        const { mobileButtonBar, filterForm } = this.pageElements;\n\n        // Save restaurants for later\n        this.restaurants = restaurants;\n\n        // Populate filters and display the restaurants\n        this.populateFilterForm();\n        this.populateRestaurantsList();\n        this.loadMap();\n\n        // Attach event listeners for the mobile view\n        filterForm.addEventListener('change', this.handleFilterUpdates.bind(this));\n      })\n      .catch(console.error);\n  },\n\n  populateFilterForm() {\n    const neighborhoods = [...new Set(this.restaurants.map(r => r.neighborhood))];\n    const cuisines = [...new Set(this.restaurants.map(r => r.cuisine_type))];\n    const { neighborhoodSelect, cuisineSelect } = this.pageElements;\n\n    populateSelectBox(neighborhoodSelect, neighborhoods);\n    populateSelectBox(cuisineSelect, cuisines);\n  },\n\n  handleFilterUpdates(event) {\n    const { neighborhoodSelect, cuisineSelect } = this.pageElements;\n    const neighborhood = neighborhoodSelect[neighborhoodSelect.selectedIndex].value;\n    const cuisine = cuisineSelect[cuisineSelect.selectedIndex].value;\n\n    DBHelper.fetchRestaurants()\n      .then(restaurants => {\n        if (!restaurants) throw Error('Restaurants could not be displayed');\n\n        restaurants = (cuisine !== 'all') ? \n          restaurants.filter(r => r.cuisine_type === cuisine) : \n          restaurants;\n        \n        restaurants = (neighborhood !== 'all') ?\n          restaurants.filter(r => r.neighborhood === neighborhood) :\n          restaurants;\n        \n        this.restaurants = restaurants;\n        this.populateRestaurantsList();\n      })\n      .catch(console.error);\n    \n    event.stopPropagation();\n  },\n\n  populateRestaurantsList() {\n    if (this.restaurants) {\n      const { restaurantsList, restaurantResultCount } = this.pageElements;\n      const docFrag = document.createDocumentFragment();\n      const rCount = this.restaurants.length;\n\n      this.restaurants.forEach(r => {\n        docFrag.appendChild(createRestaurant(r));\n      });\n\n      this.resetRestaurants();\n\n      restaurantsList.appendChild(docFrag);\n      restaurantResultCount.innerHTML = `\n        Displaying <span class=\"restaurant-count__text\">${rCount}</span> \n        restaurant${rCount === 1 ? '' : 's'}\n      `;\n\n      lazyLoadImages();\n      this.updateMap();\n    }\n  },\n\n  resetRestaurants() {\n    const { restaurantsList, restaurantResultCount } = this.pageElements;\n    restaurantsList.innerHTML = '';\n    restaurantResultCount.innerHTML = 'Displaying <span class=\"restaurant-count__text\">0</span> restaurants';\n  },\n\n  updateMap() {\n    if (!this.map) {\n      return;\n    }\n\n    const markers = this.restaurants.map(r => ({\n      position: r.latlng,\n      content: `\n        <div class=\"infoWindow\">\n          <h2 class=\"infoWindow__title\">${r.name}</h2>\n          <address class=\"infoWindow__address\">${r.address}</address>\n          <a href=\"${DBHelper.restaurantUrl(r)}\" class=\"View more information about ${r.name}\" title=\"\">View Details</a>\n        </div>\n      `\n    }));\n\n    this.resetMap();\n    this.map.addMarkers(markers);\n  },\n\n  loadMap() {\n    this.map = new Map(document.querySelector('.map'));\n    this.restaurants && this.updateMap();\n  },\n\n  resetMap() {\n    this.map && this.map.removeMarkers();\n  }\n};\n\nexport default IndexController;\n"],"sourceRoot":""}