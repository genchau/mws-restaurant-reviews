{"version":3,"sources":["webpack:///./src/js/controllers/RestaurantController.js"],"names":["RestaurantController","map","restaurant","pageElements","breadcrumbs","document","querySelector","restaurantContainer","restaurantName","restaurantCuisine","restaurantHoursToday","restaurantAddress","restaurantNeighborhood","restaurantStarRating","restaurantHoursContainer","restaurantImageContainer","reviewsContainer","render","_this","this","restaurantId","Object","_utils__WEBPACK_IMPORTED_MODULE_0__","fetchRestaurant","then","title","concat","name","fillBreadcrumb","renderRestaurant","loadMap","catch","console","error","generateImage","populateHeader","generateAverageRating","populateAddress","populateDetails","renderReviews","_this$pageElements","_this$restaurant","cuisine","cuisine_type","operatingHours","operating_hours","daysOfTheWeek","keys","todayNum","Date","getDay","currentDay","textContent","_this$restaurant2","id","altText","loadingIndicator","createElement","className","appendChild","src","restaurantImgUrl","size","sizes","alt","image","parentNode","removeChild","_this$restaurant3","averageReview","reviews","link","setAttribute","length","_this$pageElements2","_this$restaurant4","address","neighborhood","docFrag","createDocumentFragment","table","tr","thead","thead_tr","cloneNode","tbody","tbody_tr","th","td","day","day_th","day_td","innerHTML","includes","replace","generateHoursHtml","paragraph","reviewsList","forEach","review","li","div","p","reviewTop","reviewBody","username","starRating","date","comment","rating","comments","generateReviewHtml","classList","add","latlng","zoom","center","lat","lng","addMarkers","position","event","target","closePopup","__webpack_exports__"],"mappings":"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","file":"./js/restaurant.min.js","sourcesContent":["import {\n  DBHelper,\n  lazyLoadImages,\n  getUrlParameter,\n  makeImage,\n  makeStarRating,\n  Map\n} from '../utils';\n\n/**\n * Generates the HTML output for the operating hours table\n */\nconst generateHoursHtml = operatingHours => {\n  const docFrag = document.createDocumentFragment();\n  const table = document.createElement('table');\n  const tr = document.createElement('tr');\n  const thead = document.createElement('thead');\n  const thead_tr = tr.cloneNode();\n  const tbody = document.createElement('tbody');\n  const tbody_tr = tr.cloneNode();\n  const th = document.createElement('th');\n  const td = document.createElement('td');\n\n  table.className = 'restaurant__hours';\n\n  thead.appendChild(thead_tr);\n  tbody.appendChild(tbody_tr);\n\n  for (let day in operatingHours) {\n    let day_th = th.cloneNode();\n    let day_td = td.cloneNode();\n\n    day_th.textContent = day;\n    day_td.innerHTML = (operatingHours[day].includes(',') ? operatingHours[day].replace(', ', '<br>') : operatingHours[day]);\n    day_td.setAttribute('data-th', day);\n\n    thead_tr.appendChild(day_th);\n    tbody_tr.appendChild(day_td);\n  }\n\n  table.appendChild(thead);\n  table.appendChild(tbody);\n\n  docFrag.appendChild(table);\n  \n  return docFrag;\n};\n\n/**\n * Generates the HTML output for a review\n */\nconst generateReviewHtml = review => {\n  const li = document.createElement('li');\n  const div = document.createElement('div');\n  const p = document.createElement('p');\n  const reviewTop = div.cloneNode();\n  const reviewBody = div.cloneNode();\n  const username = p.cloneNode();\n  const starRating = div.cloneNode();\n  const date = p.cloneNode();\n  const comment = p.cloneNode();\n\n  li.className = 'restaurant__review';\n  reviewTop.className = 'review__top';\n  reviewBody.className = 'review__body';\n\n  // Review Top\n  username.textContent = review.name;\n  username.className = 'review__username';\n  reviewTop.appendChild(username);\n\n  starRating.className = 'star-rating';\n  starRating.setAttribute('aria-label', `User rating: ${review.rating}`);\n  starRating.appendChild(makeStarRating(review.rating / 5 * 100));\n  reviewTop.appendChild(starRating);\n  \n  // Review Body\n  date.textContent = review.date;\n  date.className = 'review__date';\n  comment.innerHTML = review.comments;\n  comment.className = 'review__comment';\n  reviewBody.appendChild(date);\n  reviewBody.appendChild(comment);\n\n  li.appendChild(reviewTop);\n  li.appendChild(reviewBody);\n\n  return li;\n};\n\n/**\n * The restaurant page controller\n */\nconst RestaurantController = {\n  map: null,\n  restaurant: null,\n  pageElements: {\n    breadcrumbs: document.querySelector('.breadcrumbs__nav-list'),\n    restaurantContainer: document.querySelector('.restaurant'),\n    restaurantName: document.querySelector('.restaurant__name'),\n    restaurantCuisine: document.querySelector('.restaurant__cuisine'),\n    restaurantHoursToday: document.querySelector('.hours-today__text'),\n    restaurantAddress: document.querySelector('.restaurant__address'),\n    restaurantNeighborhood: document.querySelector('.restaurant__neighborhood'),\n    restaurantStarRating: document.querySelector('.restaurant__star-rating'),\n    restaurantHoursContainer: document.querySelector('.restaurant__hours-container'),\n    restaurantImageContainer: document.querySelector('.restaurant__image-container'),\n    reviewsContainer: document.querySelector('.restaurant__reviews-container'),\n  },\n\n  /**\n   * Page controller entry point to begin rendering page elements\n   */\n  render() {\n    const restaurantId = +getUrlParameter('id');\n\n    if (!restaurantId) {\n      console.error('The restaurant ID could not be located');\n      return;\n    }\n\n    DBHelper.fetchRestaurant(restaurantId)\n      .then(restaurant => {\n        this.restaurant = restaurant;\n        document.title += ` | ${this.restaurant.name}`;\n\n        this.fillBreadcrumb();\n        this.renderRestaurant();\n        this.loadMap();\n      })\n      .catch(console.error);\n  },\n\n  /**\n   * Renders restaurant information\n   */\n  renderRestaurant() {\n    // Populate restaurant content\n    this.generateImage();\n    this.populateHeader();\n    this.generateAverageRating();\n    this.populateAddress();\n    this.populateDetails();\n    this.renderReviews();\n    lazyLoadImages();\n  },\n\n  /**\n   * Populates the restaurant header with content\n   */\n  populateHeader() {\n    const { restaurantName, restaurantCuisine, restaurantHoursToday } = this.pageElements;\n    const { name, cuisine_type: cuisine, operating_hours: operatingHours } = this.restaurant;\n    const daysOfTheWeek = Object.keys(operatingHours);\n    const todayNum = new Date().getDay();\n    const currentDay = daysOfTheWeek[todayNum > 0 ? todayNum - 1 : todayNum];\n    \n    restaurantName.textContent = name;\n    restaurantCuisine.textContent = cuisine;\n    restaurantHoursToday.textContent = operatingHours[currentDay];\n  },\n\n  /**\n   * Generates an IMG element for the current restaurant\n   */\n  generateImage() {\n    const { restaurantImageContainer } = this.pageElements;\n    const { id, altText } = this.restaurant;\n    const loadingIndicator = document.createElement('span');\n    \n    loadingIndicator.className = 'spinner';\n    restaurantImageContainer.appendChild(loadingIndicator);\n\n    restaurantImageContainer.appendChild(makeImage({\n      id,\n      src: DBHelper.restaurantImgUrl({id, size: 'small' }),\n      sizes: \"100vw\",\n      alt: altText,\n      className: 'restaurant__image',\n    }, image => {\n      loadingIndicator.parentNode && \n        loadingIndicator.parentNode.removeChild(loadingIndicator);\n      \n      restaurantImageContainer.appendChild(image);\n    }));\n  },\n\n  /**\n   * Generates the average star rating\n   */\n  generateAverageRating() {\n    const { restaurantStarRating } = this.pageElements;\n    const { averageReview, reviews } = this.restaurant;\n    const link = document.createElement('a');\n\n    // Add stars\n    restaurantStarRating.appendChild(makeStarRating(averageReview));\n\n    // Add link\n    link.setAttribute('href', '#reviews');\n    link.setAttribute('title', 'Skip to customer reviews');\n    link.className = 'star-rating__link';\n    link.textContent = `${reviews.length} reviews`;\n\n    restaurantStarRating.appendChild(link);\n  },\n\n  /**\n   * Populates the restaurant address and neighborhood\n   */\n  populateAddress() {\n    const { restaurantAddress, restaurantNeighborhood } = this.pageElements;\n    const { address, neighborhood } = this.restaurant;\n\n    restaurantAddress.textContent = address;\n    restaurantNeighborhood.textContent = neighborhood;\n  },\n\n  /**\n   * Populates restaurant details section\n   */\n  populateDetails() {\n    const { restaurantHoursContainer } = this.pageElements;\n    const { operating_hours: operatingHours } = this.restaurant;\n\n    restaurantHoursContainer.appendChild(generateHoursHtml(operatingHours));\n  },\n  \n  /**\n   * Renders reviews if there are any\n   */\n  renderReviews() {\n    const { reviews } = this.restaurant;\n    const { reviewsContainer } = this.pageElements;\n    const docFrag = document.createDocumentFragment();\n\n    if (!reviews) {\n      const paragraph = document.createElement('p');\n\n      paragraph.textContent = `${this.restaurant.name} does not have any reviews`;\n      paragraph.className = 'restaurant-reviews__empty';\n      reviewsContainer.appendChild(paragraph);\n\n      return;\n    }\n\n    const reviewsList = document.createElement('ul');\n    reviewsList.className = 'restaurant__reviews';\n\n    reviews.forEach(review => {\n      docFrag.appendChild(generateReviewHtml(review));\n    });\n\n    reviewsList.appendChild(docFrag);\n    reviewsContainer.appendChild(reviewsList);\n  },\n\n  /**\n   * Populates the page breadcrumbs\n   */\n  fillBreadcrumb() {\n    const { breadcrumbs } = this.pageElements;\n    const li = document.createElement('li');\n    \n    li.textContent = this.restaurant.name;\n    li.classList.add('breadcrumbs__nav-item');\n    li.setAttribute('aria-current', 'page');\n\n    breadcrumbs.appendChild(li);\n  },\n\n  loadMap() {\n    const { latlng } = this.restaurant;\n\n    // Create the map\n    this.map = new Map(document.querySelector('.restaurant__map'), {\n      zoom: 16,\n      center: [latlng.lat, latlng.lng]\n    });\n\n    // Add a marker\n    this.map.addMarkers([{\n      position: [latlng.lat, latlng.lng],\n    }], event => event.target.closePopup());\n  },\n}\n\nexport default RestaurantController;\n"],"sourceRoot":""}